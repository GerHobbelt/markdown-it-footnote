{"version":3,"file":"markdownItFootnote.modern.js","sources":["../index.js"],"sourcesContent":["// Process footnotes\n//\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Renderer partials\n\nfunction anchorFnDefault(n, excludeSubId, tokens, idx, options, env, slf) {\n  let prefix = '';\n  if (typeof env.docId === 'string' && env.docId.length > 0) {\n    prefix = '-' + env.docId + '-';\n  }\n  return prefix + n;\n}\n\nfunction captionFnDefault(n, tokens, idx, options, env, slf) {\n  return '[' + n + ']';\n}\n\nfunction headerFnDefault(state) {\n  return '';\n}\n\n\nexport default function footnote_plugin(md, plugin_options) {\n  let parseLinkLabel = md.helpers.parseLinkLabel,\n      isSpace = md.utils.isSpace;\n\n  plugin_options = plugin_options || {};\n  plugin_options.atDocumentEnd = typeof plugin_options.atDocumentEnd === 'undefined' ? true : plugin_options.atDocumentEnd;\n\n  let anchorFn = plugin_options && plugin_options.anchor ? plugin_options.anchor : anchorFnDefault;\n  let captionFn = plugin_options && plugin_options.caption ? plugin_options.caption : captionFnDefault;\n  let headerFn = plugin_options && plugin_options.header ? plugin_options.header : headerFnDefault;\n\n  function render_footnote_n(tokens, idx, excludeSubId) {\n    let n = Number(tokens[idx].meta.id + 1).toString();\n\n    if (!excludeSubId && tokens[idx].meta.subId > 0) {\n      n += ':' + tokens[idx].meta.subId;\n    }\n\n    return n;\n  }\n\n  function render_footnote_anchor_name(tokens, idx, options, env, slf) {\n    let n = render_footnote_n(tokens, idx, true);\n    return anchorFn(n, true, tokens, idx, options, env, slf);\n  }\n\n  function render_footnote_caption(tokens, idx, options, env, slf) {\n    let n = render_footnote_n(tokens, idx);\n    return captionFn(n, tokens, idx, options, env, slf);\n  }\n\n  function render_footnote_ref(tokens, idx, options, env, slf) {\n    let id      = slf.rules.footnote_anchor_name(tokens, idx, options, env, slf);\n    let caption = slf.rules.footnote_caption(tokens, idx, options, env, slf);\n    let refid   = render_footnote_n(tokens, idx);\n    refid = anchorFn(refid, false, tokens, idx, options, env, slf);\n\n    if (tokens[idx].meta.text) {\n      return '<a href=\"#fn' + id + '\" id=\"fnref' + refid + '\">' +\n            tokens[idx].meta.text +\n            '<sup class=\"footnote-ref\">' + caption + '</sup></a>';\n    }\n\n    return '<sup class=\"footnote-ref\"><a href=\"#fn' + id + '\" id=\"fnref' + refid + '\">' + caption + '</a></sup>';\n  }\n\n  function render_footnote_block_open(tokens, idx, options) {\n    let header = tokens[idx].markup;\n    return (options.xhtmlOut ? '<hr class=\"footnotes-sep\" />\\n' : '<hr class=\"footnotes-sep\">\\n') +\n         '<section class=\"footnotes\">\\n' +\n           (header ? '<h3 class=\"footnotes-header\">' + header + '</h3>' : '') +\n         '<ol class=\"footnotes-list\">\\n';\n  }\n\n  function render_footnote_block_close() {\n    return '</ol>\\n</section>\\n';\n  }\n\n  function render_footnote_open(tokens, idx, options, env, slf) {\n    let id = slf.rules.footnote_anchor_name(tokens, idx, options, env, slf);\n\n/*\n  if (tokens[idx].meta.subId > 0) {\n    id += ':' + tokens[idx].meta.subId;\n  }\n*/\n\n    return '<li tabindex=\"-1\" id=\"fn' + id + '\" class=\"footnote-item\">';\n  }\n\n  function render_footnote_close() {\n    return '</li>\\n';\n  }\n\n  function render_footnote_anchor(tokens, idx, options, env, slf) {\n    let refid = render_footnote_n(tokens, idx);\n    refid = anchorFn(refid, false, tokens, idx, options, env, slf);\n\n    /* â†© with escape code to prevent display as Apple Emoji on iOS */\n    return ' <a href=\"#fnref' + refid + '\" class=\"footnote-backref\">\\u21a9\\uFE0E</a>';\n  }\n\n\n  md.renderer.rules.footnote_ref          = render_footnote_ref;\n  md.renderer.rules.footnote_block_open   = render_footnote_block_open;\n  md.renderer.rules.footnote_block_close  = render_footnote_block_close;\n  md.renderer.rules.footnote_open         = render_footnote_open;\n  md.renderer.rules.footnote_close        = render_footnote_close;\n  md.renderer.rules.footnote_anchor       = render_footnote_anchor;\n\n  // helpers (only used in other rules, no tokens are attached to those)\n  md.renderer.rules.footnote_caption      = render_footnote_caption;\n  md.renderer.rules.footnote_anchor_name  = render_footnote_anchor_name;\n\n  // Process footnote block definition\n  function footnote_def(state, startLine, endLine, silent) {\n    let oldBMark, oldTShift, oldSCount, oldParentType, pos, label, token,\n        initial, offset, ch, posAfterColon,\n        start = state.bMarks[startLine] + state.tShift[startLine],\n        max = state.eMarks[startLine];\n\n    // line should be at least 5 chars - \"[^x]:\"\n    if (start + 4 > max) { return false; }\n\n    if (state.src.charCodeAt(start) !== 0x5B/* [ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5E/* ^ */) { return false; }\n\n    for (pos = start + 2; pos < max; pos++) {\n      if (state.src.charCodeAt(pos) === 0x20 /* space */) { return false; }\n      if (state.src.charCodeAt(pos) === 0x5D /* ] */) {\n        break;\n      }\n    }\n\n    if (pos === start + 2) { return false; } // no empty footnote labels\n    if (pos + 1 >= max || state.src.charCodeAt(++pos) !== 0x3A /* : */) { return false; }\n    if (silent) { return true; }\n    pos++;\n\n    if (!state.env.footnotes) { state.env.footnotes = {}; }\n    if (!state.env.footnotes.refs) { state.env.footnotes.refs = {}; }\n    label = state.src.slice(start + 2, pos - 2);\n    state.env.footnotes.refs[':' + label] = -1;\n\n    token       = new state.Token('footnote_reference_open', '', 1);\n    token.meta  = { label: label };\n    token.level = state.level++;\n    state.tokens.push(token);\n\n    oldBMark = state.bMarks[startLine];\n    oldTShift = state.tShift[startLine];\n    oldSCount = state.sCount[startLine];\n    oldParentType = state.parentType;\n\n    posAfterColon = pos;\n    initial = offset = state.sCount[startLine] + pos - (state.bMarks[startLine] + state.tShift[startLine]);\n\n    while (pos < max) {\n      ch = state.src.charCodeAt(pos);\n\n      if (isSpace(ch)) {\n        if (ch === 0x09) {\n          offset += 4 - offset % 4;\n        } else {\n          offset++;\n        }\n      } else {\n        break;\n      }\n\n      pos++;\n    }\n\n    state.tShift[startLine] = pos - posAfterColon;\n    state.sCount[startLine] = offset - initial;\n\n    state.bMarks[startLine] = posAfterColon;\n    state.blkIndent += 4;\n    state.parentType = 'footnote';\n\n    if (state.sCount[startLine] < state.blkIndent) {\n      state.sCount[startLine] += state.blkIndent;\n    }\n\n    state.md.block.tokenize(state, startLine, endLine, true);\n\n    state.parentType = oldParentType;\n    state.blkIndent -= 4;\n    state.tShift[startLine] = oldTShift;\n    state.sCount[startLine] = oldSCount;\n    state.bMarks[startLine] = oldBMark;\n\n    token       = new state.Token('footnote_reference_close', '', -1);\n    token.level = --state.level;\n    state.tokens.push(token);\n\n    return true;\n  }\n\n  // Process inline footnotes (^[...])\n  function footnote_inline(state, silent) {\n    let labelStart,\n        labelEnd,\n        footnoteId,\n        token,\n        tokens,\n        max = state.posMax,\n        start = state.pos;\n\n    if (start + 2 >= max) { return false; }\n    if (state.src.charCodeAt(start) !== 0x5E/* ^ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5B/* [ */) { return false; }\n\n    labelStart = start + 2;\n    labelEnd = parseLinkLabel(state, start + 1);\n\n    // parser failed to find ']', so it's not a valid note\n    if (labelEnd < 0) { return false; }\n\n    // We found the end of the link, and know for a fact it's a valid link;\n    // so all that's left to do is to call tokenizer.\n    //\n    if (!silent) {\n      // inline blocks have their own *child* environment in markdown-it v10+.\n      // As the footnotes must live beyond the lifetime of the inline block env,\n      // we must patch them into the `parentState.env` for the footnote_tail\n      // handler to be able to access them afterwards!\n      let parentEnv = state.env.parentState.env;\n      if (!parentEnv.footnotes) { parentEnv.footnotes = {}; }\n      if (!parentEnv.footnotes.list) { parentEnv.footnotes.list = []; }\n      footnoteId = parentEnv.footnotes.list.length;\n\n      token      = state.push('footnote_ref', '', 0);\n      //token.meta = { id: footnoteId, subId: 0, label: null };\n      token.meta = { id: footnoteId };\n\n      state.md.inline.parse(\n        state.src.slice(labelStart, labelEnd),\n        state.md,\n        state.env,\n        tokens = []\n      );\n\n      parentEnv.footnotes.list[footnoteId] = {\n        content: state.src.slice(labelStart, labelEnd),\n        tokens: tokens\n      };\n    }\n\n    state.pos = labelEnd + 1;\n    state.posMax = max;\n    return true;\n  }\n\n  // Process footnote references with text ([^label ...])\n  function footnote_ref_with_text(state, silent) {\n    let label,\n        pos,\n        footnoteId,\n        footnoteSubId,\n        token,\n        max = state.posMax,\n        start = state.pos;\n\n    // should be at least 6 chars - \"[^l x]\"\n    if (start + 5 > max) { return false; }\n\n    if (!state.env.footnotes || !state.env.footnotes.refs) { return false; }\n    if (state.src.charCodeAt(start) !== 0x5B/* [ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5E/* ^ */) { return false; }\n\n    for (pos = start + 2; pos < max; pos++) {\n      if (state.src.charCodeAt(pos) === 0x0A /* linefeed */) { return false; }\n      if (state.src.charCodeAt(pos) === 0x5D /* ] */) {\n        break;\n      }\n    }\n\n    if (pos === start + 2) { return false; } // no empty footnote labels\n    if (pos >= max) { return false; }\n    pos++;\n\n    label = state.src.slice(start + 2, pos - 1);\n    if (!label || !label.match(/^(\\S+)\\s+(.+)$/)) { return false; }\n    label = RegExp.$1;\n    let text = RegExp.$2;\n\n    if (typeof state.env.footnotes.refs[':' + label] === 'undefined') { return false; }\n\n    if (!silent) {\n      if (!state.env.footnotes.list) { state.env.footnotes.list = []; }\n\n      if (state.env.footnotes.refs[':' + label] < 0) {\n        footnoteId = state.env.footnotes.list.length;\n        state.env.footnotes.list[footnoteId] = { label: label, count: 0 };\n        state.env.footnotes.refs[':' + label] = footnoteId;\n      } else {\n        footnoteId = state.env.footnotes.refs[':' + label];\n      }\n\n      footnoteSubId = state.env.footnotes.list[footnoteId].count;\n      state.env.footnotes.list[footnoteId].count++;\n\n      token      = state.push('footnote_ref', '', 0);\n      token.meta = { id: footnoteId, subId: footnoteSubId, label: label, text: text };\n    }\n\n    state.pos = pos;\n    state.posMax = max;\n    return true;\n  }\n\n  // Process footnote references ([^...])\n  function footnote_ref(state, silent) {\n    let label,\n        pos,\n        footnoteId,\n        footnoteSubId,\n        token,\n        max = state.posMax,\n        start = state.pos;\n\n    // should be at least 4 chars - \"[^x]\"\n    if (start + 3 > max) { return false; }\n\n    if (!state.env.footnotes || !state.env.footnotes.refs) { return false; }\n    if (state.src.charCodeAt(start) !== 0x5B/* [ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5E/* ^ */) { return false; }\n\n    for (pos = start + 2; pos < max; pos++) {\n      if (state.src.charCodeAt(pos) === 0x20) { return false; }\n      if (state.src.charCodeAt(pos) === 0x0A) { return false; }\n      if (state.src.charCodeAt(pos) === 0x5D /* ] */) {\n        break;\n      }\n    }\n\n    if (pos === start + 2) { return false; } // no empty footnote labels\n    if (pos >= max) { return false; }\n    pos++;\n\n    label = state.src.slice(start + 2, pos - 1);\n    if (typeof state.env.footnotes.refs[':' + label] === 'undefined') { return false; }\n\n    if (!silent) {\n      if (!state.env.footnotes.list) { state.env.footnotes.list = []; }\n\n      if (state.env.footnotes.refs[':' + label] < 0) {\n        footnoteId = state.env.footnotes.list.length;\n        state.env.footnotes.list[footnoteId] = { label: label, count: 0 };\n        state.env.footnotes.refs[':' + label] = footnoteId;\n      } else {\n        footnoteId = state.env.footnotes.refs[':' + label];\n      }\n\n      footnoteSubId = state.env.footnotes.list[footnoteId].count;\n      state.env.footnotes.list[footnoteId].count++;\n\n      token      = state.push('footnote_ref', '', 0);\n      token.meta = { id: footnoteId, subId: footnoteSubId, label: label };\n    }\n\n    state.pos = pos;\n    state.posMax = max;\n    return true;\n  }\n\n  // Glue footnote tokens to end of token stream\n  function footnote_tail(state) {\n    let i, l, j, t, lastParagraph, list, token, tokens, current, currentLabel,\n        lastRefIndex = 0,\n        insideRef = false,\n        refTokens = {};\n\n    if (!state.env.footnotes) { return; }\n\n    let oldLen = state.tokens.length;\n    state.tokens = state.tokens.filter(function (tok, idx) {\n      if (tok.type === 'footnote_reference_open') {\n        insideRef = true;\n        current = [];\n        currentLabel = tok.meta.label;\n        return false;\n      }\n      if (tok.type === 'footnote_reference_close') {\n        insideRef = false;\n        // prepend ':' to avoid conflict with Object.prototype members\n        refTokens[':' + currentLabel] = current;\n        lastRefIndex = idx;\n        return false;\n      }\n      if (insideRef) { current.push(tok); }\n      return !insideRef;\n    });\n\n    console.error({ lastRefIndex, nextRefIndex: lastRefIndex - ((oldLen - state.tokens.length) - 1),  atDocumentEnd: plugin_options.atDocumentEnd, oldLen, tokens_length: state.tokens.length, list: state.env.footnotes.list });\n    lastRefIndex = plugin_options.atDocumentEnd ? state.tokens.length : lastRefIndex - ((oldLen - state.tokens.length) - 1);\n    let firstHalfTokens = state.tokens.slice(0, lastRefIndex);\n\n    if (!state.env.footnotes.list) { return; }\n    list = state.env.footnotes.list;\n\n    token = new state.Token('footnote_block_open', '', 1);\n    token.markup = headerFn(state);\n    firstHalfTokens.push(token);\n\n    for (i = 0, l = list.length; i < l; i++) {\n      token      = new state.Token('footnote_open', '', 1);\n      token.meta = { id: i, label: list[i].label };\n      firstHalfTokens.push(token);\n\n      if (list[i].tokens) {\n        tokens = [];\n\n        token          = new state.Token('paragraph_open', 'p', 1);\n        token.block    = true;\n        tokens.push(token);\n\n        token          = new state.Token('inline', '', 0);\n        token.children = list[i].tokens;\n        token.content  = list[i].content;\n        tokens.push(token);\n\n        token          = new state.Token('paragraph_close', 'p', -1);\n        token.block    = true;\n        tokens.push(token);\n\n      } else if (list[i].label) {\n        tokens = refTokens[':' + list[i].label] || [];\n      } else {\n        tokens = [];\n      }\n\n      firstHalfTokens = firstHalfTokens.concat(tokens);\n      if (firstHalfTokens[firstHalfTokens.length - 1].type === 'paragraph_close') {\n        lastParagraph = firstHalfTokens.pop();\n      } else {\n        lastParagraph = null;\n      }\n\n      t = list[i].count > 0 ? list[i].count : 1;\n      for (j = 0; j < t; j++) {\n        token      = new state.Token('footnote_anchor', '', 0);\n        token.meta = { id: i, subId: j, label: list[i].label };\n        firstHalfTokens.push(token);\n      }\n\n      if (lastParagraph) {\n        firstHalfTokens.push(lastParagraph);\n      }\n\n      token = new state.Token('footnote_close', '', -1);\n      firstHalfTokens.push(token);\n    }\n\n    token = new state.Token('footnote_block_close', '', -1);\n    firstHalfTokens.push(token);\n    state.tokens = firstHalfTokens.concat(state.tokens.slice(lastRefIndex));\n  }\n\n  md.block.ruler.before('reference', 'footnote_def', footnote_def, { alt: [ 'paragraph', 'reference' ] });\n  md.inline.ruler.after('image', 'footnote_inline', footnote_inline);\n  md.inline.ruler.after('footnote_inline', 'footnote_ref_with_text', footnote_ref_with_text);\n  md.inline.ruler.after('footnote_ref_with_text', 'footnote_ref', footnote_ref);\n  md.core.ruler.after('inline', 'footnote_tail', footnote_tail);\n}\n"],"names":["anchorFnDefault","n","excludeSubId","tokens","idx","options","env","slf","prefix","docId","length","captionFnDefault","headerFnDefault","state","footnote_plugin","md","plugin_options","parseLinkLabel","helpers","isSpace","utils","atDocumentEnd","anchorFn","anchor","captionFn","caption","headerFn","header","render_footnote_n","Number","meta","id","toString","subId","render_footnote_anchor_name","render_footnote_caption","render_footnote_ref","rules","footnote_anchor_name","footnote_caption","refid","text","render_footnote_block_open","markup","xhtmlOut","render_footnote_block_close","render_footnote_open","render_footnote_close","render_footnote_anchor","renderer","footnote_ref","footnote_block_open","footnote_block_close","footnote_open","footnote_close","footnote_anchor","footnote_def","startLine","endLine","silent","oldBMark","oldTShift","oldSCount","oldParentType","pos","label","token","initial","offset","ch","posAfterColon","start","bMarks","tShift","max","eMarks","src","charCodeAt","footnotes","refs","slice","Token","level","push","sCount","parentType","blkIndent","block","tokenize","footnote_inline","labelStart","labelEnd","footnoteId","posMax","parentEnv","parentState","list","inline","parse","content","footnote_ref_with_text","footnoteSubId","match","RegExp","$1","$2","count","footnote_tail","i","l","j","t","lastParagraph","current","currentLabel","lastRefIndex","insideRef","refTokens","oldLen","filter","tok","type","console","error","nextRefIndex","tokens_length","firstHalfTokens","children","concat","pop","ruler","before","alt","after","core"],"mappings":"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"}