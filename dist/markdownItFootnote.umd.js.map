{"version":3,"file":"markdownItFootnote.umd.js","sources":["../index.ts"],"sourcesContent":["// Process footnotes\n//\n\nimport { strict as assert } from 'assert';\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Renderer partials\n\n\n\ninterface FootnotePluginOptions {\n  numberSequence?: Array<any>;\n  modeOverride?: string;\n  sortOrder: number;\n  refCombiner?: string;\n}\n\ninterface GenericInfoParameters {\n  options: any;          // markdown_it options object\n  plugin_options: FootnotePluginOptions;\n  env: any;              // markdown_it environment object\n  self: any;             // reference to this plugin instance\n}\n\ninterface RenderInfoParameters extends GenericInfoParameters {\n  tokens: Array<any>;    // array of tokens\n  idx: number;           // index of current token in token array\n}\n\ninterface footnoteMetaInfo {\n  id: number;\n  label?: string;\n  labelOverride?: string;\n  mode?: string;\n  content?: string;\n  tokens?: Array<any>;\n  count: number;\n}\n\n\n\nfunction anchorFnDefault(n: number, excludeSubId: number, baseInfo: RenderInfoParameters) {\n  const env = baseInfo.env;\n  assert.ok(env != null);\n  let prefix = '';\n  if (typeof env.docId === 'string' && env.docId.length > 0) {\n    prefix = '-' + env.docId + '-';\n  }\n  return prefix + n;\n}\n\nfunction captionFnDefault(n, baseInfo: RenderInfoParameters) {\n  //return '[' + n + ']';\n  return '' + n;\n}\n\nfunction headerFnDefault(category, baseInfo: GenericInfoParameters) {\n  switch (category) {\n  case 'aside':\n    return 'Side Notes';\n\n  case 'section':\n    return 'Section Notes';\n\n  case 'end':\n    return 'Endnotes';\n\n  default:                  // used for error category, e.g. 'Error::Unused'\n    return category;\n  }\n}\n\nfunction determine_footnote_symbol(idx: number, info: footnoteMetaInfo, baseInfo: GenericInfoParameters): string {\n  const plugin_options = baseInfo.plugin_options;\n  assert.ok(plugin_options != null);\n\n  // rule to construct the printed label:\n  //\n  //     mark = labelOverride  /* || info.label */  || idx;\n  const label = info.labelOverride;\n  if (label) {\n    return label;\n  }\n  if (plugin_options.numberSequence == null || plugin_options.numberSequence.length === 0) {\n    return '' + idx;\n  }\n  const len = plugin_options.numberSequence.length;\n  if (idx >= len) {\n    // is last slot numeric or alphanumerically?\n    const slot = plugin_options.numberSequence[len - 1];\n    if (Number.isFinite(slot)) {\n      const delta = idx - len + 1;\n      return '' + (slot + delta);\n    }\n\n    // non-numerical last slot --> duplicate, triplicate, etc.\n    const dupli = (idx / len) | 0;  // = int(x mod N)\n    const remainder = idx % len;\n    const core = plugin_options.numberSequence[remainder];\n    let str = '' + core;\n    for (let i = 1; i < dupli; i++) {\n      str += core;\n    }\n    return str;\n  }\n\n  return '' + plugin_options.numberSequence[idx];\n}\n\n\nconst bunched_mode_classes = [ '', 'footnote-bunched-ref-ref', 'footnote-bunched-ref-text' ];\n\n\nfunction generateFootnoteRefHtml(id, caption, refId, bunched_footnote_ref_mode, renderInfo: RenderInfoParameters) {\n  let localOverride = renderInfo.tokens[renderInfo.idx].meta.text;\n  if (localOverride) {\n    localOverride = `<span class=\"footnote-ref-extra-text\">${ localOverride }</span>`;\n  }\n  return `<a class=\"footnote-ref ${ bunched_mode_classes[bunched_footnote_ref_mode] }\" href=\"#fn${ id }\" id=\"fnref${ refId }\">${ localOverride || '' }<sup class=\"footnote-ref\">${ caption }</sup></a>` +\n    (bunched_footnote_ref_mode !== 0 ? `<sup class=\"footnote-ref-combiner ${ bunched_mode_classes[bunched_footnote_ref_mode] }\">${ renderInfo.plugin_options.refCombiner || '' }</sup>` : '');\n}\n\nfunction generateFootnoteSectionStartHtml(renderInfo: RenderInfoParameters) {\n  const tok = renderInfo.tokens[renderInfo.idx];\n  assert.ok(tok != null);\n  assert.ok(tok.meta != null);\n  const header = (tok.markup ? `<h3 class=\"footnotes-header\">${ tok.markup }</h3>` : '');\n  let category = tok.meta.category;\n  assert.ok(category.length > 0);\n  // `category` can contain CSS class illegal characters, e.g. when category = 'Error::Unused':\n  category = category.replace(/[^a-zA-Z0-9_-]+/g, '_');\n  return `<hr class=\"footnotes-sep footnotes-category-${ category }\" id=\"fnsection-hr-${ tok.meta.sectionId }\"${ renderInfo.options.xhtmlOut ? ' /' : '' }><aside class=\"footnotes footnotes-category-${ category }\" id=\"fnsection-${ tok.meta.sectionId }\">${ header }<ul class=\"footnotes-list\">\\n`;\n}\n\nfunction generateFootnoteSectionEndHtml(renderInfo: RenderInfoParameters) {\n  return '</ul>\\n</aside>\\n';\n}\n\nfunction generateFootnoteStartHtml(id, caption, renderInfo: RenderInfoParameters) {\n  // allow both a JavaWScript --> CSS approach via `data-footnote-caption`\n  // and a classic CSS approach while a display:inline-block SUP presenting\n  // the LI 'button' instead:\n  return `<li tabindex=\"-1\" id=\"fn${ id }\" class=\"footnote-item\" data-footnote-caption=\"${ caption }\"><span class=\"footnote-caption\"><sup class=\"footnote-caption\">${ caption }</sup></span><span class=\"footnote-content\">`;\n}\n\nfunction generateFootnoteEndHtml(renderInfo: RenderInfoParameters) {\n  return '</span></li>\\n';\n}\n\nfunction generateFootnoteBackRefHtml(id, refId, renderInfo: RenderInfoParameters) {\n  const tok = renderInfo.tokens[renderInfo.idx];\n  assert.ok(tok != null);\n  assert.ok(tok.meta != null);\n\n  /* ↩ with escape code to prevent display as Apple Emoji on iOS */\n  return ` <a href=\"#fnref${ refId }\" class=\"footnote-backref footnote-backref-${ tok.meta.subId } footnote-backref-R${ tok.meta.backrefCount - tok.meta.subId - 1 }\">\\u21a9\\uFE0E</a>`;\n}\n\n\n\n\n/*\nref:\n  return `<label aria-describedby=\"fn${id}\" role=\"presentation\" class=\"sidelink\" for=\"fn${id}-content\">\n<a aria-hidden=\"true\" href=\"#fn${id}\"><output class=\"highlight fnref\" id=\"fnref${refid}\">${caption}\n</output></a></label>`;\n\n\nopen:\n  return `<aside id=\"fn${id}\" class=\"sidenote\" role=\"note\">\n    <output aria-hidden=\"true\" class=\"highlight\" id=\"fn${id}-content\">\n    <label role=\"presentation\" for=\"fnref${id}\">`;\n}\n\nfunction render_sidenote_close() {\n  return '</label></output></aside>\\n';\n}\n\n*/\n\n\n\n\ninterface FootnotePluginOptions /* extends FootnotePluginOptions */ {                       // eslint-disable-line no-redeclare\n  anchorFn: (n: number, excludeSubId: number, baseInfo: RenderInfoParameters) => string;\n  captionFn: (n: number, baseInfo: RenderInfoParameters) => string;\n  headerFn: (category: string, baseInfo: GenericInfoParameters) => string;\n  mkLabel: (idx: number, info: footnoteMetaInfo, baseInfo: GenericInfoParameters) => string;\n}\n\n\n\n\nconst default_plugin_options: FootnotePluginOptions = {\n  // atDocumentEnd: false,               -- obsoleted option of the original plugin\n\n  anchorFn: anchorFnDefault,\n  captionFn: captionFnDefault,\n  headerFn: headerFnDefault,\n  mkLabel: determine_footnote_symbol,\n\n  // see also https://www.editage.com/insights/footnotes-in-tables-part-1-choice-of-footnote-markers-and-their-sequence\n  // why asterisk/star is not part of the default footnote marker sequence.\n  //\n  // For similar reasons, we DO NOT include the section § symbol in this list.\n  //\n  // when numberSequnce is NULL/empty, a regular numerical numbering is assumed.\n  // Otherwise, the array is indexed; when there are more footnotes than entries in\n  // the numberSequence array, the entries are re-used, but doubled/trippled, etc.\n  //\n  // When the indexing in this array hits a NUMERIC value (as last entry), any higher\n  // footnotes are NUMBERED starting at that number.\n  //\n  // NOTE: as we can reference the same footnote from multiple spots, we do not depend\n  // on CSS counter() approaches by default, but providee this mechanism in the plugin\n  // code itself.\n  numberSequence: [ '†', '‡', '††', '‡‡', '¶', 1 ],\n\n  // Overrides the footnode mode when set to one of the following:\n  //\n  // Recognized 'modes':\n  // '>': aside note (default for inline notes)\n  // ':': end node\n  // '=': section note (default for regular referenced notes)\n  //\n  // Also accepts these keywords: 'aside', 'section', 'end'\n  //\n  modeOverride: null,\n\n  // list section notes and endnotes in order of:\n  //\n  // 0: first *appearance* in the text\n  // 1: first *reference* in the text\n  // 2: *definition* in the text\n  // 3: sorted alphanumerically by *coded* label,\n  //    i.e. *numeric* labels are sorted in numeric order (so `10` comes AFTER `7`!),\n  //    while all others are sorted using `String.localeCompare()`. When labels have\n  //    a *numeric leading*, e.g. `71geo` --> `71`, that part is sorted numerically first.\n  //\n  //    Here 'coded label' means the label constructed from the reference ids and label overrides\n  //    as used in the markdown source, using the expression\n  //           labelOverride || reference || id\n  //    which gives for these examples (assuming them to be the only definitions in your input):\n  //           [^refA]: ...      -->  null || 'refA' || 1\n  //           [^refB LBL]: ...  -->  'LBL' || 'refB' || 2\n  // 4: sorted alphanumerically by *printed* label\n  //    which is like mode 3, but now for the label as will be seen in the *output*!\n  sortOrder: 4,\n\n  // what to print between bunched-together footnote references, i.e. the '+' in `blabla¹⁺²`\n  refCombiner: ','\n};\n\n\n\n\nexport default function footnote_plugin(md, plugin_options) {\n  const parseLinkLabel = md.helpers.parseLinkLabel,\n        isSpace = md.utils.isSpace;\n\n  plugin_options = Object.assign({}, default_plugin_options, plugin_options);\n\n\n\n  const modeOverrideMap = {\n    aside: '>',\n    section: '=',\n    end: ':'\n  };\n\n  function determine_mode(mode: string, default_mode: string) {\n    let override = null;\n    if (plugin_options.modeOverride) {\n      const mode = modeOverrideMap[plugin_options.modeOverride] || plugin_options.modeOverride;\n      if ('>:='.includes(plugin_options.modeOverride)) {\n        override = plugin_options.modeOverride;\n      }\n    }\n    if ('>:='.includes(mode)) {\n      return {\n        mode: override || mode,\n        fromInput: true\n      };\n    }\n    return {\n      mode: override || default_mode,\n      fromInput: false\n    };\n  }\n\n  function render_footnote_n(tokens, idx, excludeSubId) {\n    const mark = tokens[idx].meta.id;\n    assert.ok(Number.isFinite(mark));\n    assert.ok(mark > 0);\n    let n = '' + mark; // = mark.toString();\n    assert.ok(n.length > 0);\n\n    if (!excludeSubId && tokens[idx].meta.subId > 0) {\n      n += '-' + tokens[idx].meta.subId;\n    }\n\n    return n;\n  }\n\n  function render_footnote_mark(renderInfo: RenderInfoParameters): string {\n    const token = renderInfo.tokens[renderInfo.idx];\n    assert.ok(token != null);\n    assert.ok(renderInfo.env.footnotes != null);\n    assert.ok(renderInfo.env.footnotes.list != null);\n    const info = renderInfo.env.footnotes.list[token.meta.id];\n    assert.ok(info != null);\n    const mark: string = plugin_options.mkLabel(token.meta.id, info, renderInfo);\n    assert.ok(mark.length > 0);\n    return mark;\n  }\n\n  function render_footnote_anchor_name(renderInfo: RenderInfoParameters) {\n    const n = render_footnote_n(renderInfo.tokens, renderInfo.idx, true);\n    return plugin_options.anchorFn(n, true, renderInfo);\n  }\n\n  function render_footnote_anchor_nameRef(renderInfo: RenderInfoParameters) {\n    const n = render_footnote_n(renderInfo.tokens, renderInfo.idx, false);\n    return plugin_options.anchorFn(n, false, renderInfo);\n  }\n\n  function render_footnote_caption(renderInfo: RenderInfoParameters) {\n    const n = render_footnote_mark(renderInfo);\n    return plugin_options.captionFn(n, renderInfo);\n  }\n\n  function render_footnote_ref(tokens, idx, options, env, self) {\n    const renderInfo: RenderInfoParameters = {\n      tokens,\n      idx,\n      options,\n      env,\n      plugin_options,\n      self\n    };\n    const id      = render_footnote_anchor_name(renderInfo);\n    const caption = render_footnote_caption(renderInfo);\n    const refId   = render_footnote_anchor_nameRef(renderInfo);\n\n    // check if multiple footnote references are bunched together:\n    // IFF they are, we should separate them with commas.\n    //\n    // Exception: when next token has an extra text (`meta.text`) the\n    // bunching together is not a problem as them the output will render\n    // like this: `bla<sup>1</sup><a>text<sup>2</sup></a>`, ergo a look\n    // like this: `bla¹text²` instead of bunched footnotes references ¹ and ²\n    // that would (without the extra comma injection) look like `bla¹²` instead\n    // of `x¹⁺²` (here '+' instead of ',' comma, but you get the idea -- there's no\n    // Unicode superscript-comma so that's why I used unicode superscript-plus\n    // in this 'ascii art' example).\n    //\n    const next_token = tokens[idx + 1] || {};\n    const next_token_meta = next_token.meta || {};\n    const bunched_footnote_ref_mode = (next_token.type === 'footnote_ref' ? !next_token_meta.text ? 1 : 2 : 0);\n\n    return generateFootnoteRefHtml(id, caption, refId, bunched_footnote_ref_mode, renderInfo);\n  }\n\n  function render_footnote_block_open(tokens, idx, options, env, self) {\n    const renderInfo: RenderInfoParameters = {\n      tokens,\n      idx,\n      options,\n      env,\n      plugin_options,\n      self\n    };\n    return generateFootnoteSectionStartHtml(renderInfo);\n  }\n\n  function render_footnote_block_close(tokens, idx, options, env, self) {\n    const renderInfo: RenderInfoParameters = {\n      tokens,\n      idx,\n      options,\n      env,\n      plugin_options,\n      self\n    };\n    return generateFootnoteSectionEndHtml(renderInfo);\n  }\n\n  function render_footnote_reference_open(tokens, idx, options, env, self) {\n    return '';\n  }\n\n  function render_footnote_reference_close() {\n    return '';\n  }\n\n  function render_footnote_mark_end_of_block() {\n    return '';\n  }\n\n  function render_footnote_open(tokens, idx, options, env, self) {\n    const renderInfo: RenderInfoParameters = {\n      tokens,\n      idx,\n      options,\n      env,\n      plugin_options,\n      self\n    };\n    const id = render_footnote_anchor_name(renderInfo);\n    const caption = render_footnote_caption(renderInfo);\n\n    // allow both a JavaScript --> CSS approach via `data-footnote-caption`\n    // and a classic CSS approach while a display:inline-block SUP presenting\n    // the LI 'button' instead:\n    return generateFootnoteStartHtml(id, caption, renderInfo);\n  }\n\n  function render_footnote_close(tokens, idx, options, env, self) {\n    const renderInfo: RenderInfoParameters = {\n      tokens,\n      idx,\n      options,\n      env,\n      plugin_options,\n      self\n    };\n    return generateFootnoteEndHtml(renderInfo);\n  }\n\n  function render_footnote_anchor_backref(tokens, idx, options, env, self) {\n    const renderInfo: RenderInfoParameters = {\n      tokens,\n      idx,\n      options,\n      env,\n      plugin_options,\n      self\n    };\n\n    const tok = tokens[idx];\n    assert.ok(tok != null);\n    assert.ok(tok.meta != null);\n    const id = render_footnote_anchor_name(renderInfo);\n    let refId = render_footnote_n(tokens, idx, false);\n    refId = plugin_options.anchorFn(refId, false, renderInfo);\n\n    return generateFootnoteBackRefHtml(id, refId, renderInfo);\n  }\n\n\n\n  md.renderer.rules.footnote_ref          = render_footnote_ref;\n  md.renderer.rules.footnote_block_open   = render_footnote_block_open;\n  md.renderer.rules.footnote_block_close  = render_footnote_block_close;\n  md.renderer.rules.footnote_reference_open   = render_footnote_reference_open;\n  md.renderer.rules.footnote_reference_close  = render_footnote_reference_close;\n  md.renderer.rules.footnote_mark_end_of_block = render_footnote_mark_end_of_block;\n  md.renderer.rules.footnote_open         = render_footnote_open;\n  md.renderer.rules.footnote_close        = render_footnote_close;\n  md.renderer.rules.footnote_anchor       = render_footnote_anchor_backref;\n\n\n\n  function obtain_footnote_info_slot(env, label: string|null, at_definition: boolean) {\n    // inline blocks have their own *child* environment in markdown-it v10+.\n    // As the footnotes must live beyond the lifetime of the inline block env,\n    // we must patch them into the `parentState.env` for the footnote_tail\n    // handler to be able to access them afterwards!\n    while (env.parentState) {\n      env = env.parentState.env;\n      assert.ok(env != null);\n    }\n\n    if (!env.footnotes) {\n      env.footnotes = {\n        // map label tto ID:\n        refs: {},\n        // store footnote info indexed by ID\n        list: [],\n        // remap ID to re-ordered ID (determines placement order for section notes and endnotes)\n        idMap: [ 0 ],\n        idMapCounter: 0,\n\n        // and a counter for the generated sections (including asides); see the demo/test which\n        // uses the generated `#fnsection-DDD` identifiers to hack/fix the styling, for example.\n        sectionCounter: 0\n      };\n    }\n\n    // When label is NULL, this is a request from in INLINE NOTE.\n\n    // NOTE: IDs are index numbers, BUT they start at 1 instead of 0 to make life easier in check code:\n    let footnoteId;\n    let infoRec: footnoteMetaInfo;\n    // label as index: prepend ':' to avoid conflict with Object.prototype members\n    if (label == null || !env.footnotes.refs[':' + label]) {\n      footnoteId = Math.max(1, env.footnotes.list.length);\n      infoRec = {\n        id: footnoteId,\n        label,\n        labelOverride: null,\n        mode: null,\n        content: null,\n        tokens: null,\n        count: 0\n      };\n      env.footnotes.list[footnoteId] = infoRec;\n      if (label != null) {\n        env.footnotes.refs[':' + label] = footnoteId;\n      }\n    } else {\n      footnoteId = env.footnotes.refs[':' + label];\n      infoRec = env.footnotes.list[footnoteId];\n      assert.ok(!!infoRec, 'expects non-NULL footnote info record');\n    }\n\n    const idMap = env.footnotes.idMap;\n\n    // now check if the idMap[] has been set up already as well. This depends on\n    // when WE are invoked (`at_definition`) and the configured `options.sortOrder`:\n    switch (plugin_options.sortOrder) {\n    // 0: first *appearance* in the text\n    default:\n    case 0:\n      // basically, this means: order as-is\n      if (!idMap[footnoteId]) {\n        idMap[footnoteId] = ++env.footnotes.idMapCounter;\n      }\n      break;\n\n    // 1: first *reference* in the text\n    case 1:\n      if (!at_definition && !idMap[footnoteId]) {\n        // first reference is now!\n        idMap[footnoteId] = ++env.footnotes.idMapCounter;\n      }\n      break;\n\n    // 2: *definition* in the text\n    case 2:\n      if (at_definition && !idMap[footnoteId]) {\n        // definition is now!\n        idMap[footnoteId] = ++env.footnotes.idMapCounter;\n      }\n      break;\n\n    // 3: sorted alphanumerically by label (inline footnotes will end up at the top, before all other notes)\n    case 3:\n    case 4:\n      // just note the footnoteId now; this must be re-ordered later when we have collected all footnotes.\n      //\n      // set it up when we get there...\n      break;\n    }\n\n    return infoRec;\n  }\n\n  function find_end_of_block_marker(state, startIndex) {\n    let idx, len;\n    const tokens = state.tokens;\n    for (idx = startIndex, len = tokens.length; idx < len; idx++) {\n      if (tokens[idx].type === 'footnote_mark_end_of_block') { return idx; }\n    }\n\n    // Punch a slot into the token stream (at the very end)\n    // for consistency with footnote_mark_end_of_block():\n    const token = new state.Token('footnote_mark_end_of_block', '', 0);\n    token.hidden = true;\n    tokens.push(token);\n    return tokens.length - 1;\n  }\n\n  function update_end_of_block_marker(state, footnoteId) {\n    // inject marker into parent = block level token stream to announce the advent of an (inline) footnote:\n    // because the markdown_it code uses a for() loop to go through the parent nodes while parsing the\n    // 'inline' chunks, we CANNOT safely inject a marker BEFORE the chunk, only AFTERWARDS:\n    const parentState = state.env.parentState;\n    const parentIndex = state.env.parentTokenIndex;\n    const markerTokenIndex = find_end_of_block_marker(parentState, parentIndex + 1);\n    const token = parentState.tokens[markerTokenIndex];\n    if (!token.meta) {\n      token.meta = {\n        footnote_list: []\n      };\n    }\n    token.meta.footnote_list.push(footnoteId);\n  }\n\n  // Mark end of paragraph/heading/whatever BLOCK (or rather: START of the next block!)\n  function footnote_mark_end_of_block(state, startLine, endLine, silent) {\n    if (!silent && state.tokens.length > 0) {\n      const token = state.push('footnote_mark_end_of_block', '', 0);\n      token.hidden = true;\n    }\n    return false;\n  }\n\n\n\n  // Process footnote block definition\n  function footnote_def(state, startLine, endLine, silent) {\n    let oldBMark, oldTShift, oldSCount, oldParentType, pos, token,\n        initial, offset, ch, posAfterColon,\n        start = state.bMarks[startLine] + state.tShift[startLine],\n        max = state.eMarks[startLine];\n\n    // line should be at least 6 chars - \"[^x]: \" or \"[^x]:> \"\n    if (start + 5 > max) { return false; }\n\n    if (state.src.charCodeAt(start) !== 0x5B/* [ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5E/* ^ */) { return false; }\n\n    for (pos = start + 2; pos < max; pos++) {\n      if (state.src.charCodeAt(pos) === 0x0A /* LF */) { return false; }\n      if (state.src.charCodeAt(pos) === 0x5D /* ] */) {\n        break;\n      }\n    }\n    const labelEnd = pos;\n\n    if (pos === start + 2) { return false; } // no empty footnote labels\n    if (pos + 1 >= max || state.src.charCodeAt(++pos) !== 0x3A /* : */) { return false; }\n\n    const mode_rec = determine_mode(state.src[pos + 1], '=');   // default mode is section_note mode.\n    if (mode_rec.fromInput) { pos++; }\n    const mode = mode_rec.mode;\n\n    if (pos + 1 >= max || state.src.charCodeAt(++pos) !== 0x20 /* space */) { return false; }\n    if (silent) { return true; }\n    pos++;\n\n    const labelInfo = decode_label(state.src.slice(start + 2, labelEnd), true);\n    if (!labelInfo) { return false; }\n    assert.ok(!labelInfo.extraText);\n\n    // Now see if we already have a footnote ID for this footnote label:\n    // fetch it if we have one and otherwise produce a new one so everyone\n    // can use this from now on.\n    //\n    // This scenario is possible when the footnote *definition* comes BEFORE\n    // the first actual footnote *use* (*reference*). This is UNUSUAL when people\n    // write texts, but it is *not impossible*, particularly now that we have\n    // specified-by-design that endnotes can be marked as such (`[^label]:: note text`)\n    // and freely mixed with sidenotes (`[^label]:> note text`) and section\n    // notes (`[^label]:= note text` (explicit mode) or `[^label]: note text`\n    // (implicit mode)), where *section notes* will placed at the spot in the text\n    // flow where they were *defined*. Again, highly irregular, BUT someone MAY\n    // feel the need to place some section note *definitions* ABOVE their first\n    // use point.\n    //\n    const infoRec = obtain_footnote_info_slot(state.env, labelInfo.label, true);\n    if (labelInfo.labelOverride) {\n      infoRec.labelOverride = labelInfo.labelOverride;\n    }\n    infoRec.mode = mode;\n    infoRec.content = state.src.slice(pos, max);\n\n    token = state.push('footnote_reference_open', '', 1);\n    token.meta = {\n      id: infoRec.id\n    };\n    token.hidden = true;\n\n    oldBMark = state.bMarks[startLine];\n    oldTShift = state.tShift[startLine];\n    oldSCount = state.sCount[startLine];\n    oldParentType = state.parentType;\n\n    posAfterColon = pos;\n    initial = offset = state.sCount[startLine] + pos - (state.bMarks[startLine] + state.tShift[startLine]);\n\n    while (pos < max) {\n      ch = state.src.charCodeAt(pos);\n\n      if (isSpace(ch)) {\n        if (ch === 0x09) {\n          offset += 4 - offset % 4;\n        } else {\n          offset++;\n        }\n      } else {\n        break;\n      }\n\n      pos++;\n    }\n\n    state.tShift[startLine] = pos - posAfterColon;\n    state.sCount[startLine] = offset - initial;\n\n    state.bMarks[startLine] = posAfterColon;\n    state.blkIndent += 4;\n    state.parentType = 'footnote';\n\n    if (state.sCount[startLine] < state.blkIndent) {\n      state.sCount[startLine] += state.blkIndent;\n    }\n\n    state.md.block.tokenize(state, startLine, endLine, true);\n\n    state.parentType = oldParentType;\n    state.blkIndent -= 4;\n    state.tShift[startLine] = oldTShift;\n    state.sCount[startLine] = oldSCount;\n    state.bMarks[startLine] = oldBMark;\n\n    token = state.push('footnote_reference_close', '', -1);\n    token.meta = {\n      id: infoRec.id\n    };\n\n    return true;\n  }\n\n\n\n  // Process inline footnotes (^[...] or ^[>...])\n  function footnote_inline(state, silent) {\n    let labelStart,\n        labelEnd,\n        token,\n        tokens,\n        max = state.posMax,\n        start = state.pos;\n\n    if (start + 2 >= max) { return false; }\n    if (state.src.charCodeAt(start) !== 0x5E/* ^ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5B/* [ */) { return false; }\n\n    labelStart = start + 2;\n\n    // NOTE: inline notes are automatically considered to be ASIDE notes,\n    // UNLESS otherwise specified!\n    //\n    // Recognized 'modes':\n    // '>': aside note (default for inline notes)\n    // ':': end node\n    // '=': section note (default for regular referenced notes)\n    //\n    // (Also note https://v4.chriskrycho.com/2015/academic-markdown-and-citations.html:\n    // our notes look like this: `[^ref]:` while Academic MarkDown references look\n    // like this: `[@Belawog2012]` i.e. no '^' in there. Hence these can safely co-exist.)\n    //\n    const mode_rec = determine_mode(state.src[start + 2], '>');   // default mode is aside ~ sidenote mode.\n    if (mode_rec.fromInput) {\n      labelStart++;\n    }\n    const mode = mode_rec.mode;\n\n    labelEnd = parseLinkLabel(state, start + 1);\n\n    // parser failed to find ']', so it's not a valid note\n    if (labelEnd < 0) { return false; }\n\n    // We found the end of the link, and know for a fact it's a valid link;\n    // so all that's left to do is to call tokenizer.\n    //\n    if (!silent) {\n      // WARNING: claim our footnote slot for there MAY be nested footnotes\n      // discovered in the next inline.parse() call below!\n      const infoRec = obtain_footnote_info_slot(state.env, null, true);\n      infoRec.mode = mode;\n      infoRec.count++;\n\n      token = state.push('footnote_ref', '', 0);\n      token.meta = {\n        id: infoRec.id\n      };\n\n      state.md.inline.parse(\n        state.src.slice(labelStart, labelEnd),\n        state.md,\n        state.env,\n        tokens = []\n      );\n\n      // Now fill our previously claimed slot:\n      infoRec.content = state.src.slice(labelStart, labelEnd);\n      infoRec.tokens = tokens;\n\n      // inject marker into parent = block level token stream to announce the advent of an (inline) footnote:\n      // because the markdown_it code uses a for() loop to go through the parent nodes while parsing the\n      // 'inline' chunks, we CANNOT safely inject a marker BEFORE the chunk, only AFTERWARDS:\n      update_end_of_block_marker(state, infoRec.id);\n\n      //md.block.ruler.enable('footnote_mark_end_of_block');\n    }\n\n    state.pos = labelEnd + 1;\n    state.posMax = max;\n    return true;\n  }\n\n\n\n  // Check if this is a valid ffootnote reference label.\n  //\n  // Also see if there's a label OVERRIDE text or marker ('@') provided.\n  //\n  // Return the parsed label record.\n  function decode_label(label: string, extra_text_is_labelOverride: boolean) {\n    if (!label) {\n      return null;\n    }\n    const m = label.match(/^(@?)(\\S+)(?:\\s+(.+))?$/);  // label with OPTIONAL override text...\n    if (!m) {\n      return null;\n    }\n    assert.ok(m[2].length > 0);\n    let extraText = m[3]?.trim();\n    // label [output] override?\n    let override = null;\n    if (m[1]) {\n      override = m[2];\n    }\n    if (extra_text_is_labelOverride && extraText) {\n      override = extraText;\n      extraText = null;\n    }\n\n    return {\n      label: m[2],\n      labelOverride: override,\n      extraText\n    };\n  }\n\n\n\n  // Process footnote references with text ([^label ...])\n  function footnote_ref_with_text(state, silent) {\n    let pos,\n        footnoteSubId,\n        token,\n        max = state.posMax,\n        start = state.pos;\n\n    // should be at least 6 chars - \"[^l x]\"\n    if (start + 5 > max) { return false; }\n\n    if (state.src.charCodeAt(start) !== 0x5B/* [ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5E/* ^ */) { return false; }\n\n    for (pos = start + 2; pos < max; pos++) {\n      if (state.src.charCodeAt(pos) === 0x0A /* linefeed */) { return false; }\n      if (state.src.charCodeAt(pos) === 0x5D /* ] */) {\n        break;\n      }\n    }\n\n    if (pos === start + 2) { return false; } // no empty footnote labels\n    if (pos >= max) { return false; }\n    pos++;\n\n    const labelInfo = decode_label(state.src.slice(start + 2, pos - 1), false);\n    if (!labelInfo || !labelInfo.extraText) { return false; }\n    assert.ok(labelInfo.extraText.length > 0);\n\n    const infoRec = obtain_footnote_info_slot(state.env, labelInfo.label, false);\n    if (labelInfo.labelOverride) {\n      infoRec.labelOverride = labelInfo.labelOverride;\n    }\n\n    if (!silent) {\n      footnoteSubId = infoRec.count;\n\n      infoRec.count++;\n\n      token = state.push('footnote_ref', '', 0);\n      token.meta = {\n        id: infoRec.id,\n        subId: footnoteSubId,\n        text: labelInfo.extraText\n      };\n\n      update_end_of_block_marker(state, infoRec.id);\n\n      //md.block.ruler.enable('footnote_mark_end_of_block');\n    }\n\n    state.pos = pos;\n    state.posMax = max;\n    return true;\n  }\n\n\n\n  // Process footnote references ([^...])\n  function footnote_ref(state, silent) {\n    let pos,\n        footnoteSubId,\n        token,\n        max = state.posMax,\n        start = state.pos;\n\n    // should be at least 4 chars - \"[^x]\"\n    if (start + 3 > max) { return false; }\n\n    if (state.src.charCodeAt(start) !== 0x5B/* [ */) { return false; }\n    if (state.src.charCodeAt(start + 1) !== 0x5E/* ^ */) { return false; }\n\n    for (pos = start + 2; pos < max; pos++) {\n      //if (state.src.charCodeAt(pos) === 0x20) { return false; }\n      if (state.src.charCodeAt(pos) === 0x0A) { return false; }\n      if (state.src.charCodeAt(pos) === 0x5D /* ] */) {\n        break;\n      }\n    }\n\n    if (pos === start + 2) { return false; } // no empty footnote labels\n    if (pos >= max) { return false; }\n    pos++;\n\n    const labelInfo = decode_label(state.src.slice(start + 2, pos - 1), true);\n    if (!labelInfo) { return false; }\n    assert.ok(!labelInfo.extraText);\n\n    const infoRec = obtain_footnote_info_slot(state.env, labelInfo.label, false);\n    if (labelInfo.labelOverride) {\n      infoRec.labelOverride = labelInfo.labelOverride;\n    }\n\n    if (!silent) {\n      footnoteSubId = infoRec.count;\n\n      infoRec.count++;\n\n      token = state.push('footnote_ref', '', 0);\n      token.meta = {\n        id: infoRec.id,\n        subId: footnoteSubId\n      };\n\n      update_end_of_block_marker(state, infoRec.id);\n\n      //md.block.ruler.enable('footnote_mark_end_of_block');\n    }\n\n    state.pos = pos;\n    state.posMax = max;\n    return true;\n  }\n\n\n\n  function place_footnote_definitions_at(state, token_idx: number, footnote_id_list, category: string, baseInfo: GenericInfoParameters) {\n    if (footnote_id_list.length === 0) {\n      return; // nothing to inject...\n    }\n\n    let inject_tokens = [];\n    assert.ok(baseInfo.env.footnotes.list != null);\n    const footnote_spec_list = baseInfo.env.footnotes.list;\n\n    let token = new state.Token('footnote_block_open', '', 1);\n    token.markup = plugin_options.headerFn(category, baseInfo.env, plugin_options);\n    token.meta = {\n      sectionId: ++baseInfo.env.footnotes.sectionCounter,\n      category\n    };\n    inject_tokens.push(token);\n\n    for (const id of footnote_id_list) {\n      const fn = footnote_spec_list[id];\n      const inject_start_index = inject_tokens.length;\n\n      token      = new state.Token('footnote_open', '', 1);\n      token.meta = {\n        id,\n        category\n      };\n      inject_tokens.push(token);\n\n      if (fn.label == null) {\n        // process an inline footnote text:\n        token          = new state.Token('paragraph_open', 'p', 1);\n        token.block    = true;\n        inject_tokens.push(token);\n\n        token          = new state.Token('inline', '', 0);\n        token.children = fn.tokens;\n        token.content  = fn.content;\n        inject_tokens.push(token);\n\n        token          = new state.Token('paragraph_close', 'p', -1);\n        token.block    = true;\n        inject_tokens.push(token);\n      } else {\n        // process a labeled footnote:\n        inject_tokens = inject_tokens.concat(fn.tokens || []);\n      }\n\n      //let lastParagraph;\n      //if (inject_tokens[inject_tokens.length - 1].type === 'paragraph_close') {\n      //  lastParagraph = inject_tokens.pop();\n      //} else {\n      //  lastParagraph = null;\n      //}\n\n      const cnt = fn.count;\n      assert.ok(cnt >= 0);\n      for (let j = 0; j < cnt; j++) {\n        token = new state.Token('footnote_anchor', '', 0);\n        token.meta = {\n          id,\n          subId: j,\n          backrefCount: cnt,\n          category\n        };\n        inject_tokens.push(token);\n      }\n\n      //if (lastParagraph) {\n      //  inject_tokens.push(lastParagraph);\n      //}\n\n      token = new state.Token('footnote_close', '', -1);\n      token.meta = {\n        id,\n        category\n      };\n      inject_tokens.push(token);\n    }\n\n    token = new state.Token('footnote_block_close', '', -1);\n    token.meta = {\n      category\n    };\n    inject_tokens.push(token);\n\n    state.tokens.splice(token_idx, 0, ...inject_tokens);\n  }\n\n  function more_footnote_reference_blocks_follow_immediately(tokens, idx) {\n    let tok = tokens[idx];\n    while (tok && (tok.type === 'footnote_mark_end_of_block' || tok.type === 'footnote_reference_close')) {\n      idx++;\n      tok = tokens[idx];\n    }\n    return tok && (tok.type === 'footnote_reference_open');\n  }\n\n  // Glue footnote tokens into appropriate slots of token stream.\n  function footnote_tail(state, startLine, endLine, silent) {\n    let i, l, j, t, token, current, currentRefToken,\n        insideRef = false,\n        refTokens = {};\n\n    if (!state.env.footnotes) {\n      // no footnotes at all? --> filter out all 'footnote_mark_end_of_block' chunks:\n      state.tokens = state.tokens.filter(function (tok, idx) {\n        return (tok.type !== 'footnote_mark_end_of_block');\n      });\n      return;\n    }\n\n    const idMap = state.env.footnotes.idMap;\n\n    const baseInfo: GenericInfoParameters = {\n      options: state.md.options,\n      env: state.env,\n      plugin_options,\n      self: this\n    };\n\n    function footnote_print_comparer(idA, idB) {\n      return idMap[idA] - idMap[idB];\n    }\n\n\n    // Rewrite the tokenstream to place the aside-footnotes and section footnotes where they need to be:\n    const footnote_spec_list = state.env.footnotes.list;\n\n    // extract the tokens constituting the footnote/sidenote *content* and\n    // store that bunch in `refTokens[:<currentLabel>]` instead, to be injected back into\n    // the tokenstream at the appropriate spots.\n    state.tokens = state.tokens.filter(function (tok, idx) {\n      switch (tok.type) {\n      // filter out 'footnote_mark_end_of_block' tokens which follow BLOCKS that do not contain any\n      // footnote/sidenote/endnote references:\n      case 'footnote_mark_end_of_block':\n        if (!tok.meta) return false;\n        if (!tok.meta.footnote_list) return false;\n        break;\n\n      case 'footnote_reference_open':\n        insideRef = true;\n        current = [];\n        currentRefToken = tok;\n        return true;\n\n      case 'footnote_reference_close':\n        insideRef = false;\n\n        const infoRec = footnote_spec_list[tok.meta.id];\n        infoRec.tokens = current;\n\n        return true;\n      }\n      if (insideRef) {\n        current.push(tok);\n      }\n      return !insideRef;\n    });\n\n\n    // execute configured sorting/mapping (`idMap`):\n    switch (plugin_options.sortOrder) {\n    // 0: first *appearance* in the text\n    default:\n    case 0:\n    // 1: first *reference* in the text\n    case 1:\n    // 2: *definition* in the text\n    case 2:\n      // order is specified in the `idMap` already.\n      break;\n\n    // 3: sorted alphanumerically by label (inline footnotes will end up at the top, before all other notes)\n    case 3:\n    case 4:\n      // the `idMap[]` array has not been set up and must be produced\n      // to turn this into an alphanumerically-by-label sort order, where\n      // a `footnoteId` based index will produce the order of appearance.\n      const reIdMap = [];\n      for (let i = 1; i < footnote_spec_list.length; i++) {\n        reIdMap[i - 1] = i;\n      }\n      reIdMap.sort((idA, idB) => {\n        const infoA = footnote_spec_list[idA];\n        const infoB = footnote_spec_list[idB];\n        assert.ok(infoA);\n        assert.ok(infoB);\n\n        // is any of these an inline footnote, i.e. without any label yet? Produce a fake label for sorting then!\n        //\n        // As stated elsewhere: inline section_notes and end_notes will end up among everyone else in this sort order mode.\n        assert.ok(infoA.id === idA);\n        assert.ok(infoB.id === idB);\n\n        // Split a \"sort label\" up into its numerical part and the tail. Note that we don't call\n        // it 'tail' but 'label', because we will need to compare the ENTIRE LABEL using string comparison\n        // when the numeric leaders are identical, so as to ensure that 'labels' such as `00000` will sort\n        // as 'higher' than `000`, both of which will be rated as numerically identical!\n        function to_atoms(label) {\n          // now extract number or numerical leader part.\n          //\n          // Only accept OBVIOUS, SIMPLE NUMERIC LEADERS! This is about *legibility*\n          // of those numrical leaders, not a pedantic \"what is possibly legally numeric\"\n          // challenge. Hence we DO NOT accept leading +/- and only a decimal dot when\n          // there's a decimal number BEFORE it, such as in `5.1hack` --> `5.1`, but NOT\n          // `.42oz`!\n          //\n          // Do not use `nmr = +lbl` as that would treat labels such as `0xf4` as hexadecimal numbers,\n          // which we DO NOT want to happen.\n          const m = label.match(/^\\d+(?:\\.\\d+)?/) || [ 'x' ];\n          const nmr = +m[0] || Infinity;   // non-numeric labels are rated NUMEICALLY HIGHER than any numerical leader.\n          return {\n            label,\n            number: nmr\n          };\n        }\n\n        const labelA = (plugin_options.sortOrder === 3 ?\n          infoA.labelOverride || infoA.label || ('' + infoA.id) :\n          plugin_options.mkLabel(infoA.id, infoA, baseInfo)\n        );\n        const labelB = (plugin_options.sortOrder === 3 ?\n          infoB.labelOverride || infoB.label || ('' + infoB.id) :\n          plugin_options.mkLabel(infoB.id, infoB, baseInfo)\n        );\n        const atomA = to_atoms(labelA);\n        const atomB = to_atoms(labelB);\n        const diff = atomA.number - atomB.number;\n        return diff || atomA.label.localeCompare(atomB.label);\n        // ^^^^^^^ shorthand for:\n        //\n        // if (isNaN(diff) || diff === 0) then stringcompare else numeric-difference\n      });\n\n      // Now turn this into a sort order map:\n      for (let prio = 0; prio < reIdMap.length; prio++) {\n        const id = reIdMap[prio];\n        idMap[id] = prio;\n      }\n      break;\n    }\n\n\n    const inject_tokens = [];\n\n    // Now go through the token stream and place the sidenotes, section_notes and endnotes where they belong:\n    let aside_list;\n    let section_list = new Set();\n    const section_done_list = new Set();  // once a section_note has been printed, it should never appear again!\n    const end_list = new Set();\n    const used_list = new Set();\n\n    let tokens = state.tokens;\n\n    for (i = 0; i < tokens.length; i++) {\n      const tok = tokens[i];\n      switch (tok.type) {\n      case 'footnote_mark_end_of_block':\n        // check the gathered list of footnotes referenced in this block:\n        // - dump the ones which are sidenotes\n        // - mark the ones which are section- or end-notes.\n        //\n        // Note: make sure we don't produce duplicates in the collect sets.\n        {\n          aside_list = new Set();\n\n          const refd_notes_list = (tok.meta?.footnote_list || []);\n          for (const id of refd_notes_list) {\n            const footnote = footnote_spec_list[id];\n\n            switch (footnote.mode) {\n            case '>':\n              aside_list.add(id);\n              used_list.add(id);\n              break;\n\n            case '=':\n              if (!section_done_list.has(id)) {\n                section_list.add(id);\n                section_done_list.add(id);\n                used_list.add(id);\n              }\n              break;\n\n            default:\n            case ':':\n              end_list.add(id);\n              used_list.add(id);\n              break;\n            }\n          }\n\n          const aside_ids = [];\n          for (const id of aside_list.values()) {\n            aside_ids.push(id);\n          }\n          aside_ids.sort(footnote_print_comparer);\n\n          place_footnote_definitions_at(state, i + 1, aside_ids, 'aside', baseInfo);\n          tokens = state.tokens;\n        }\n        break;\n\n      case 'footnote_reference_close':\n        // anywhere a footnote *definition* appeared in the original text is\n        // also a place to dump the section_notes gathered to date, so to speak.\n        //\n        // However, DO detect clusters of footnote definitions and MERGE them\n        // together:\n        if (more_footnote_reference_blocks_follow_immediately(tokens, i + 1)) {\n          continue;\n        } else {\n          const section_ids = [];\n          for (const id of section_list.values()) {\n            section_ids.push(id);\n          }\n          section_ids.sort(footnote_print_comparer);\n\n          place_footnote_definitions_at(state, i + 1, section_ids, 'section', baseInfo);\n          tokens = state.tokens;\n\n          // and reset the tracking set:\n          section_list = new Set();\n        }\n        break;\n      }\n    }\n\n    // Now process the endnotes:\n    {\n      const end_ids = [];\n      for (const id of end_list.values()) {\n        end_ids.push(id);\n      }\n      end_ids.sort(footnote_print_comparer);\n\n      place_footnote_definitions_at(state, tokens.length, end_ids, 'end', baseInfo);\n      tokens = state.tokens;\n    }\n\n    // Now process the unused footnotes and dump them for diagnostic purposes:\n    {\n      const unused_ids = [];\n\n      for (let i = 1; i < footnote_spec_list.length; i++) {\n        const fn = footnote_spec_list[i];\n        const id = fn.id;\n        if (!used_list.has(id)) {\n          console.error(`ERROR: footnote ID ${id} is defined but never used. Footnote will be added as an ERRONEOUS ENDNOTE to the output, so the situation is easy to diagnose!`, Object.assign({}, fn, { tokens: '......' }));\n          unused_ids.push(id);\n        }\n      }\n      unused_ids.sort(footnote_print_comparer);\n\n      place_footnote_definitions_at(state, tokens.length, unused_ids, 'Error::Unused', baseInfo);\n      //tokens = state.tokens;\n    }\n\n    // Update state_block too as we have rewritten & REPLACED the token array earlier in this call:\n    // the reference `state.env.state_block.tokens` is still pointing to the OLD token array!\n    state.env.state_block.tokens = state.tokens;\n  }\n\n\n\n\n  // attach ourselves to the start of block handling too\n  md.block.ruler.before('table', 'footnote_mark_end_of_block', footnote_mark_end_of_block);\n\n  md.block.ruler.before('reference', 'footnote_def', footnote_def, { alt: [ 'paragraph', 'reference' ] });\n  md.inline.ruler.after('image', 'footnote_inline', footnote_inline);\n  md.inline.ruler.after('footnote_inline', 'footnote_ref_with_text', footnote_ref_with_text);\n  md.inline.ruler.after('footnote_ref_with_text', 'footnote_ref', footnote_ref);\n  md.core.ruler.after('inline', 'footnote_tail', footnote_tail);\n}\n"],"names":["anchorFnDefault","n","excludeSubId","baseInfo","env","assert","ok","prefix","docId","length","captionFnDefault","headerFnDefault","category","determine_footnote_symbol","idx","info","plugin_options","label","labelOverride","numberSequence","len","slot","Number","isFinite","delta","dupli","remainder","core","str","i","bunched_mode_classes","generateFootnoteRefHtml","id","caption","refId","bunched_footnote_ref_mode","renderInfo","localOverride","tokens","meta","text","refCombiner","generateFootnoteSectionStartHtml","tok","header","markup","replace","sectionId","options","xhtmlOut","generateFootnoteSectionEndHtml","generateFootnoteStartHtml","generateFootnoteEndHtml","generateFootnoteBackRefHtml","subId","backrefCount","default_plugin_options","anchorFn","captionFn","headerFn","mkLabel","modeOverride","sortOrder","footnote_plugin","md","parseLinkLabel","helpers","isSpace","utils","Object","assign","determine_mode","mode","default_mode","override","includes","fromInput","render_footnote_n","mark","render_footnote_mark","token","footnotes","list","render_footnote_anchor_name","render_footnote_anchor_nameRef","render_footnote_caption","render_footnote_ref","self","next_token","next_token_meta","type","render_footnote_block_open","render_footnote_block_close","render_footnote_reference_open","render_footnote_reference_close","render_footnote_mark_end_of_block","render_footnote_open","render_footnote_close","render_footnote_anchor_backref","renderer","rules","footnote_ref","footnote_block_open","footnote_block_close","footnote_reference_open","footnote_reference_close","footnote_mark_end_of_block","footnote_open","footnote_close","footnote_anchor","obtain_footnote_info_slot","at_definition","parentState","refs","idMap","idMapCounter","sectionCounter","footnoteId","infoRec","Math","max","content","count","find_end_of_block_marker","state","startIndex","Token","hidden","push","update_end_of_block_marker","parentIndex","parentTokenIndex","markerTokenIndex","footnote_list","startLine","endLine","silent","footnote_def","oldBMark","oldTShift","oldSCount","oldParentType","pos","initial","offset","ch","posAfterColon","start","bMarks","tShift","eMarks","src","charCodeAt","labelEnd","mode_rec","labelInfo","decode_label","slice","extraText","sCount","parentType","blkIndent","block","tokenize","footnote_inline","labelStart","posMax","inline","parse","extra_text_is_labelOverride","m","match","trim","footnote_ref_with_text","footnoteSubId","place_footnote_definitions_at","token_idx","footnote_id_list","inject_tokens","footnote_spec_list","fn","children","concat","cnt","j","splice","more_footnote_reference_blocks_follow_immediately","footnote_tail","current","insideRef","filter","footnote_print_comparer","idA","idB","reIdMap","sort","infoA","infoB","to_atoms","nmr","Infinity","number","labelA","labelB","atomA","atomB","diff","localeCompare","prio","aside_list","section_list","Set","section_done_list","end_list","used_list","refd_notes_list","footnote","add","has","aside_ids","values","section_ids","end_ids","unused_ids","console","error","state_block","ruler","before","alt","after"],"mappings":"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"}